.include "macros.inc"

.rodata

.global lbl_80547E88
lbl_80547E88:
	.incbin "baserom.dol", 0x543F88, 0x40

.text

.global func_80454E84
func_80454E84:
/* 80454E84 004503C4  94 21 FF 70 */	stwu r1, -0x90(r1)
/* 80454E88 004503C8  7C 08 02 A6 */	mflr r0
/* 80454E8C 004503CC  90 01 00 94 */	stw r0, 0x94(r1)
/* 80454E90 004503D0  39 61 00 90 */	addi r11, r1, 0x90
/* 80454E94 004503D4  48 0C 26 79 */	bl func_8051750C
/* 80454E98 004503D8  3D 40 80 54 */	lis r10, lbl_80540004@ha
/* 80454E9C 004503DC  85 2A 7E 88 */	lwzu r9, 0x7e88(r10)
/* 80454EA0 004503E0  39 66 00 01 */	addi r11, r6, 1
/* 80454EA4 004503E4  7C 99 23 78 */	mr r25, r4
/* 80454EA8 004503E8  55 64 0F FE */	srwi r4, r11, 0x1f
/* 80454EAC 004503EC  81 0A 00 04 */	lwz r8, lbl_80540004@l(r10)
/* 80454EB0 004503F0  7C FF 3B 78 */	mr r31, r7
/* 80454EB4 004503F4  80 0A 00 08 */	lwz r0, 8(r10)
/* 80454EB8 004503F8  7C 84 5A 14 */	add r4, r4, r11
/* 80454EBC 004503FC  82 4A 00 0C */	lwz r18, 0xc(r10)
/* 80454EC0 00450400  83 6A 00 10 */	lwz r27, 0x10(r10)
/* 80454EC4 00450404  7C DE 33 78 */	mr r30, r6
/* 80454EC8 00450408  83 4A 00 14 */	lwz r26, 0x14(r10)
/* 80454ECC 0045040C  7C 7C 1B 78 */	mr r28, r3
/* 80454ED0 00450410  83 0A 00 18 */	lwz r24, 0x18(r10)
/* 80454ED4 00450414  7C BD 2B 78 */	mr r29, r5
/* 80454ED8 00450418  82 EA 00 1C */	lwz r23, 0x1c(r10)
/* 80454EDC 0045041C  7C 85 0E 70 */	srawi r5, r4, 1
/* 80454EE0 00450420  82 CA 00 20 */	lwz r22, 0x20(r10)
/* 80454EE4 00450424  7F E3 FB 78 */	mr r3, r31
/* 80454EE8 00450428  82 AA 00 24 */	lwz r21, 0x24(r10)
/* 80454EEC 0045042C  38 80 00 00 */	li r4, 0
/* 80454EF0 00450430  82 8A 00 28 */	lwz r20, 0x28(r10)
/* 80454EF4 00450434  82 6A 00 2C */	lwz r19, 0x2c(r10)
/* 80454EF8 00450438  81 8A 00 30 */	lwz r12, 0x30(r10)
/* 80454EFC 0045043C  81 6A 00 34 */	lwz r11, 0x34(r10)
/* 80454F00 00450440  80 EA 00 38 */	lwz r7, 0x38(r10)
/* 80454F04 00450444  80 CA 00 3C */	lwz r6, 0x3c(r10)
/* 80454F08 00450448  91 21 00 08 */	stw r9, 8(r1)
/* 80454F0C 0045044C  91 01 00 0C */	stw r8, 0xc(r1)
/* 80454F10 00450450  90 01 00 10 */	stw r0, 0x10(r1)
/* 80454F14 00450454  92 41 00 14 */	stw r18, 0x14(r1)
/* 80454F18 00450458  93 61 00 18 */	stw r27, 0x18(r1)
/* 80454F1C 0045045C  93 41 00 1C */	stw r26, 0x1c(r1)
/* 80454F20 00450460  93 01 00 20 */	stw r24, 0x20(r1)
/* 80454F24 00450464  92 E1 00 24 */	stw r23, 0x24(r1)
/* 80454F28 00450468  92 C1 00 28 */	stw r22, 0x28(r1)
/* 80454F2C 0045046C  92 A1 00 2C */	stw r21, 0x2c(r1)
/* 80454F30 00450470  92 81 00 30 */	stw r20, 0x30(r1)
/* 80454F34 00450474  92 61 00 34 */	stw r19, 0x34(r1)
/* 80454F38 00450478  91 81 00 38 */	stw r12, 0x38(r1)
/* 80454F3C 0045047C  91 61 00 3C */	stw r11, 0x3c(r1)
/* 80454F40 00450480  90 E1 00 40 */	stw r7, 0x40(r1)
/* 80454F44 00450484  90 C1 00 44 */	stw r6, 0x44(r1)
/* 80454F48 00450488  4B BA F4 F5 */	bl memset
/* 80454F4C 0045048C  57 20 07 FF */	clrlwi. r0, r25, 0x1f
/* 80454F50 00450490  40 82 00 20 */	bne lbl_80454F70
/* 80454F54 00450494  39 60 00 00 */	li r11, 0
/* 80454F58 00450498  39 80 00 7F */	li r12, 0x7f
/* 80454F5C 0045049C  38 A0 00 00 */	li r5, 0
/* 80454F60 004504A0  3B 60 00 00 */	li r27, 0
/* 80454F64 004504A4  3B 40 00 00 */	li r26, 0
/* 80454F68 004504A8  3B 20 00 00 */	li r25, 0
/* 80454F6C 004504AC  48 00 00 1C */	b lbl_80454F88
lbl_80454F70:
/* 80454F70 004504B0  81 7C 00 00 */	lwz r11, 0(r28)
/* 80454F74 004504B4  81 9C 00 04 */	lwz r12, 4(r28)
/* 80454F78 004504B8  80 BC 00 08 */	lwz r5, 8(r28)
/* 80454F7C 004504BC  83 7C 00 0C */	lwz r27, 0xc(r28)
/* 80454F80 004504C0  83 5C 00 10 */	lwz r26, 0x10(r28)
/* 80454F84 004504C4  83 3C 00 14 */	lwz r25, 0x14(r28)
lbl_80454F88:
/* 80454F88 004504C8  3C 60 00 01 */	lis r3, 0x0000FFFF@ha
/* 80454F8C 004504CC  3B 01 00 08 */	addi r24, r1, 8
/* 80454F90 004504D0  C8 42 20 F0 */	lfd f2, lbl_806AD370-_SDA2_BASE_(r2)
/* 80454F94 004504D4  38 83 FF FF */	addi r4, r3, 0x0000FFFF@l
/* 80454F98 004504D8  38 C0 00 00 */	li r6, 0
/* 80454F9C 004504DC  3C 00 FF FF */	lis r0, 0xffff
/* 80454FA0 004504E0  3E E0 43 30 */	lis r23, 0x4330
/* 80454FA4 004504E4  7F C9 03 A6 */	mtctr r30
/* 80454FA8 004504E8  2C 1E 00 00 */	cmpwi r30, 0
/* 80454FAC 004504EC  40 81 01 7C */	ble lbl_80455128
lbl_80454FB0:
/* 80454FB0 004504F0  A8 BD 00 00 */	lha r5, 0(r29)
/* 80454FB4 004504F4  39 40 00 00 */	li r10, 0
/* 80454FB8 004504F8  39 20 00 00 */	li r9, 0
/* 80454FBC 004504FC  39 00 00 00 */	li r8, 0
/* 80454FC0 00450500  7C 05 58 00 */	cmpw r5, r11
/* 80454FC4 00450504  38 E0 00 00 */	li r7, 0
/* 80454FC8 00450508  3B BD 00 02 */	addi r29, r29, 2
/* 80454FCC 0045050C  40 80 00 08 */	bge lbl_80454FD4
/* 80454FD0 00450510  38 E0 00 01 */	li r7, 1
lbl_80454FD4:
/* 80454FD4 00450514  7E 6B 28 50 */	subf r19, r11, r5
/* 80454FD8 00450518  7E 65 FE 70 */	srawi r5, r19, 0x1f
/* 80454FDC 0045051C  7C BB 9A 78 */	xor r27, r5, r19
/* 80454FE0 00450520  7F 65 D8 50 */	subf r27, r5, r27
/* 80454FE4 00450524  7C 1B 60 00 */	cmpw r27, r12
/* 80454FE8 00450528  41 80 00 0C */	blt lbl_80454FF4
/* 80454FEC 0045052C  39 00 00 01 */	li r8, 1
/* 80454FF0 00450530  7F 6C D8 50 */	subf r27, r12, r27
lbl_80454FF4:
/* 80454FF4 00450534  55 85 0F FE */	srwi r5, r12, 0x1f
/* 80454FF8 00450538  7C A5 62 14 */	add r5, r5, r12
/* 80454FFC 0045053C  7C BA 0E 70 */	srawi r26, r5, 1
/* 80455000 00450540  7C 1B D0 00 */	cmpw r27, r26
/* 80455004 00450544  41 80 00 0C */	blt lbl_80455010
/* 80455008 00450548  39 20 00 01 */	li r9, 1
/* 8045500C 0045054C  7F 7A D8 50 */	subf r27, r26, r27
lbl_80455010:
/* 80455010 00450550  57 45 0F FE */	srwi r5, r26, 0x1f
/* 80455014 00450554  7C A5 D2 14 */	add r5, r5, r26
/* 80455018 00450558  7C B9 0E 70 */	srawi r25, r5, 1
/* 8045501C 0045055C  7C 1B C8 00 */	cmpw r27, r25
/* 80455020 00450560  41 80 00 0C */	blt lbl_8045502C
/* 80455024 00450564  39 40 00 01 */	li r10, 1
/* 80455028 00450568  7F 79 D8 50 */	subf r27, r25, r27
lbl_8045502C:
/* 8045502C 0045056C  7E 99 51 D6 */	mullw r20, r25, r10
/* 80455030 00450570  54 E5 08 3C */	slwi r5, r7, 1
/* 80455034 00450574  57 33 0F FE */	srwi r19, r25, 0x1f
/* 80455038 00450578  20 A5 00 01 */	subfic r5, r5, 1
/* 8045503C 0045057C  7E 73 CA 14 */	add r19, r19, r25
/* 80455040 00450580  7E AC 41 D6 */	mullw r21, r12, r8
/* 80455044 00450584  7E 73 0E 70 */	srawi r19, r19, 1
/* 80455048 00450588  7E DA 49 D6 */	mullw r22, r26, r9
/* 8045504C 0045058C  7E B4 AA 14 */	add r21, r20, r21
/* 80455050 00450590  7E D3 B2 14 */	add r22, r19, r22
/* 80455054 00450594  7E D5 B2 14 */	add r22, r21, r22
/* 80455058 00450598  7C A5 B1 D6 */	mullw r5, r5, r22
/* 8045505C 0045059C  7C 05 20 00 */	cmpw r5, r4
/* 80455060 004505A0  40 81 00 08 */	ble lbl_80455068
/* 80455064 004505A4  38 A3 FF FF */	addi r5, r3, -1
lbl_80455068:
/* 80455068 004505A8  7C 05 00 00 */	cmpw r5, r0
/* 8045506C 004505AC  40 80 00 08 */	bge lbl_80455074
/* 80455070 004505B0  3C A0 FF FF */	lis r5, 0xffff
lbl_80455074:
/* 80455074 004505B4  7D 6B 2A 14 */	add r11, r11, r5
/* 80455078 004505B8  2C 0B 7F FF */	cmpwi r11, 0x7fff
/* 8045507C 004505BC  40 81 00 08 */	ble lbl_80455084
/* 80455080 004505C0  39 60 7F FF */	li r11, 0x7fff
lbl_80455084:
/* 80455084 004505C4  2C 0B 80 00 */	cmpwi r11, -32768
/* 80455088 004505C8  40 80 00 08 */	bge lbl_80455090
/* 8045508C 004505CC  39 60 80 00 */	li r11, -32768
lbl_80455090:
/* 80455090 004505D0  6D 8C 80 00 */	xoris r12, r12, 0x8000
/* 80455094 004505D4  55 12 10 3A */	slwi r18, r8, 2
/* 80455098 004505D8  91 81 00 4C */	stw r12, 0x4c(r1)
/* 8045509C 004505DC  54 D6 07 FE */	clrlwi r22, r6, 0x1f
/* 804550A0 004505E0  55 29 08 3C */	slwi r9, r9, 1
/* 804550A4 004505E4  7D 0A 92 14 */	add r8, r10, r18
/* 804550A8 004505E8  92 E1 00 48 */	stw r23, 0x48(r1)
/* 804550AC 004505EC  7D 09 42 14 */	add r8, r9, r8
/* 804550B0 004505F0  55 08 18 38 */	slwi r8, r8, 3
/* 804550B4 004505F4  54 CC 0F FE */	srwi r12, r6, 0x1f
/* 804550B8 004505F8  C8 21 00 48 */	lfd f1, 0x48(r1)
/* 804550BC 004505FC  7D 29 92 14 */	add r9, r9, r18
/* 804550C0 00450600  7C 18 44 AE */	lfdx f0, r24, r8
/* 804550C4 00450604  7D 0C 32 14 */	add r8, r12, r6
/* 804550C8 00450608  FC 21 10 28 */	fsub f1, f1, f2
/* 804550CC 0045060C  7D 0C 0E 70 */	srawi r12, r8, 1
/* 804550D0 00450610  54 E8 18 38 */	slwi r8, r7, 3
/* 804550D4 00450614  7C EA 4A 14 */	add r7, r10, r9
/* 804550D8 00450618  7C E8 3A 14 */	add r7, r8, r7
/* 804550DC 0045061C  3A D6 FF FF */	addi r22, r22, -1
/* 804550E0 00450620  FC 01 00 32 */	fmul f0, f1, f0
/* 804550E4 00450624  56 C9 07 7A */	rlwinm r9, r22, 0, 0x1d, 0x1d
/* 804550E8 00450628  54 E7 06 3E */	clrlwi r7, r7, 0x18
/* 804550EC 0045062C  7D 1F 60 AE */	lbzx r8, r31, r12
/* 804550F0 00450630  7C E7 48 30 */	slw r7, r7, r9
/* 804550F4 00450634  7D 07 3B 78 */	or r7, r8, r7
/* 804550F8 00450638  FC 00 00 1E */	fctiwz f0, f0
/* 804550FC 0045063C  7C FF 61 AE */	stbx r7, r31, r12
/* 80455100 00450640  D8 01 00 50 */	stfd f0, 0x50(r1)
/* 80455104 00450644  81 81 00 54 */	lwz r12, 0x54(r1)
/* 80455108 00450648  2C 0C 00 7F */	cmpwi r12, 0x7f
/* 8045510C 0045064C  41 81 00 08 */	bgt lbl_80455114
/* 80455110 00450650  39 80 00 7F */	li r12, 0x7f
lbl_80455114:
/* 80455114 00450654  2C 0C 60 00 */	cmpwi r12, 0x6000
/* 80455118 00450658  41 80 00 08 */	blt lbl_80455120
/* 8045511C 0045065C  39 80 60 00 */	li r12, 0x6000
lbl_80455120:
/* 80455120 00450660  38 C6 00 01 */	addi r6, r6, 1
/* 80455124 00450664  42 00 FE 8C */	bdnz lbl_80454FB0
lbl_80455128:
/* 80455128 00450668  91 7C 00 00 */	stw r11, 0(r28)
/* 8045512C 0045066C  39 61 00 90 */	addi r11, r1, 0x90
/* 80455130 00450670  7F C3 F3 78 */	mr r3, r30
/* 80455134 00450674  91 9C 00 04 */	stw r12, 4(r28)
/* 80455138 00450678  90 BC 00 08 */	stw r5, 8(r28)
/* 8045513C 0045067C  93 7C 00 0C */	stw r27, 0xc(r28)
/* 80455140 00450680  93 5C 00 10 */	stw r26, 0x10(r28)
/* 80455144 00450684  93 3C 00 14 */	stw r25, 0x14(r28)
/* 80455148 00450688  48 0C 24 11 */	bl func_80517558
/* 8045514C 0045068C  80 01 00 94 */	lwz r0, 0x94(r1)
/* 80455150 00450690  7C 08 03 A6 */	mtlr r0
/* 80455154 00450694  38 21 00 90 */	addi r1, r1, 0x90
/* 80455158 00450698  4E 80 00 20 */	blr
