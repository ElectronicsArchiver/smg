.text

.include "macros.inc"

.global InitMetroTRK
InitMetroTRK:
/* 8052B978 00526EB8  38 21 FF FC */	addi r1, r1, -4
/* 8052B97C 00526EBC  90 61 00 00 */	stw r3, 0(r1)
/* 8052B980 00526EC0  3C 60 80 69 */	lis r3, gTRKCPUState@h
/* 8052B984 00526EC4  60 63 C2 88 */	ori r3, r3, gTRKCPUState@l
/* 8052B988 00526EC8  BC 03 00 00 */	stmw r0, 0(r3)
/* 8052B98C 00526ECC  80 81 00 00 */	lwz r4, 0(r1)
/* 8052B990 00526ED0  38 21 00 04 */	addi r1, r1, 4
/* 8052B994 00526ED4  90 23 00 04 */	stw r1, 4(r3)
/* 8052B998 00526ED8  90 83 00 0C */	stw r4, 0xc(r3)
/* 8052B99C 00526EDC  7C 88 02 A6 */	mflr r4
/* 8052B9A0 00526EE0  90 83 00 84 */	stw r4, 0x84(r3)
/* 8052B9A4 00526EE4  90 83 00 80 */	stw r4, 0x80(r3)
/* 8052B9A8 00526EE8  7C 80 00 26 */	mfcr r4
/* 8052B9AC 00526EEC  90 83 00 88 */	stw r4, 0x88(r3)
/* 8052B9B0 00526EF0  7C 80 00 A6 */	mfmsr r4
/* 8052B9B4 00526EF4  60 83 80 00 */	ori r3, r4, 0x8000
/* 8052B9B8 00526EF8  68 63 80 00 */	xori r3, r3, 0x8000
/* 8052B9BC 00526EFC  7C 60 01 24 */	mtmsr r3
/* 8052B9C0 00526F00  7C 9B 03 A6 */	mtspr 0x1b, r4
/* 8052B9C4 00526F04  4B FF FA CD */	bl TRKSaveExtended1Block
/* 8052B9C8 00526F08  3C 60 80 69 */	lis r3, gTRKCPUState@h
/* 8052B9CC 00526F0C  60 63 C2 88 */	ori r3, r3, gTRKCPUState@l
/* 8052B9D0 00526F10  B8 03 00 00 */	.4byte 0xB8030000  /* illegal lmw r0, 0(r3) */
/* 8052B9D4 00526F14  38 00 00 00 */	li r0, 0
/* 8052B9D8 00526F18  7C 12 FB A6 */	mtspr 0x3f2, r0
/* 8052B9DC 00526F1C  7C 15 FB A6 */	mtspr 0x3f5, r0
/* 8052B9E0 00526F20  3C 20 80 6B */	lis r1, 0x806BFF90@h
/* 8052B9E4 00526F24  60 21 FF 90 */	ori r1, r1, 0x806BFF90@l
/* 8052B9E8 00526F28  7C A3 2B 78 */	mr r3, r5
/* 8052B9EC 00526F2C  48 00 05 A1 */	bl InitMetroTRKCommTable
/* 8052B9F0 00526F30  2C 03 00 01 */	cmpwi r3, 1
/* 8052B9F4 00526F34  40 82 00 14 */	bne lbl_8052BA08
/* 8052B9F8 00526F38  80 83 00 84 */	lwz r4, 0x84(r3)
/* 8052B9FC 00526F3C  7C 88 03 A6 */	mtlr r4
/* 8052BA00 00526F40  B8 03 00 00 */	.4byte 0xB8030000  /* illegal lmw r0, 0(r3) */
/* 8052BA04 00526F44  4E 80 00 20 */	blr 
lbl_8052BA08:
/* 8052BA08 00526F48  48 00 02 8C */	b TRK_main
/* 8052BA0C 00526F4C  4E 80 00 20 */	blr 

.global InitMetroTRK_BBA
InitMetroTRK_BBA:
/* 8052BA10 00526F50  38 21 FF FC */	addi r1, r1, -4
/* 8052BA14 00526F54  90 61 00 00 */	stw r3, 0(r1)
/* 8052BA18 00526F58  3C 60 80 69 */	lis r3, gTRKCPUState@h
/* 8052BA1C 00526F5C  60 63 C2 88 */	ori r3, r3, gTRKCPUState@l
/* 8052BA20 00526F60  BC 03 00 00 */	stmw r0, 0(r3)
/* 8052BA24 00526F64  80 81 00 00 */	lwz r4, 0(r1)
/* 8052BA28 00526F68  38 21 00 04 */	addi r1, r1, 4
/* 8052BA2C 00526F6C  90 23 00 04 */	stw r1, 4(r3)
/* 8052BA30 00526F70  90 83 00 0C */	stw r4, 0xc(r3)
/* 8052BA34 00526F74  7C 88 02 A6 */	mflr r4
/* 8052BA38 00526F78  90 83 00 84 */	stw r4, 0x84(r3)
/* 8052BA3C 00526F7C  90 83 00 80 */	stw r4, 0x80(r3)
/* 8052BA40 00526F80  7C 80 00 26 */	mfcr r4
/* 8052BA44 00526F84  90 83 00 88 */	stw r4, 0x88(r3)
/* 8052BA48 00526F88  7C 80 00 A6 */	mfmsr r4
/* 8052BA4C 00526F8C  60 83 80 00 */	ori r3, r4, 0x8000
/* 8052BA50 00526F90  7C 60 01 24 */	mtmsr r3
/* 8052BA54 00526F94  7C 9B 03 A6 */	mtspr 0x1b, r4
/* 8052BA58 00526F98  4B FF FA 39 */	bl TRKSaveExtended1Block
/* 8052BA5C 00526F9C  3C 60 80 69 */	lis r3, gTRKCPUState@h
/* 8052BA60 00526FA0  60 63 C2 88 */	ori r3, r3, gTRKCPUState@l
/* 8052BA64 00526FA4  B8 03 00 00 */	.4byte 0xB8030000  /* illegal lmw r0, 0(r3) */
/* 8052BA68 00526FA8  38 00 00 00 */	li r0, 0
/* 8052BA6C 00526FAC  7C 12 FB A6 */	mtspr 0x3f2, r0
/* 8052BA70 00526FB0  7C 15 FB A6 */	mtspr 0x3f5, r0
/* 8052BA74 00526FB4  3C 20 80 6B */	lis r1, 0x806BFF90@h
/* 8052BA78 00526FB8  60 21 FF 90 */	ori r1, r1, 0x806BFF90@l
/* 8052BA7C 00526FBC  38 60 00 02 */	li r3, 2
/* 8052BA80 00526FC0  48 00 05 0D */	bl InitMetroTRKCommTable
/* 8052BA84 00526FC4  2C 03 00 01 */	cmpwi r3, 1
/* 8052BA88 00526FC8  40 82 00 14 */	bne lbl_8052BA9C
/* 8052BA8C 00526FCC  80 83 00 84 */	lwz r4, 0x84(r3)
/* 8052BA90 00526FD0  7C 88 03 A6 */	mtlr r4
/* 8052BA94 00526FD4  B8 03 00 00 */	.4byte 0xB8030000  /* illegal lmw r0, 0(r3) */
/* 8052BA98 00526FD8  4E 80 00 20 */	blr 
lbl_8052BA9C:
/* 8052BA9C 00526FDC  48 00 01 F8 */	b TRK_main
/* 8052BAA0 00526FE0  4E 80 00 20 */	blr 

.global TRKInitializeTarget
TRKInitializeTarget:
/* 8052BAA4 00526FE4  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 8052BAA8 00526FE8  7C 08 02 A6 */	mflr r0
/* 8052BAAC 00526FEC  3C 60 80 6A */	lis r3, lbl_8069C1E4@ha
/* 8052BAB0 00526FF0  90 01 00 14 */	stw r0, 0x14(r1)
/* 8052BAB4 00526FF4  38 00 00 01 */	li r0, 1
/* 8052BAB8 00526FF8  38 63 C1 E4 */	addi r3, r3, lbl_8069C1E4@l
/* 8052BABC 00526FFC  90 03 00 98 */	stw r0, 0x98(r3)
/* 8052BAC0 00527000  4B FF DF 95 */	bl __TRK_get_MSR
/* 8052BAC4 00527004  3C A0 80 6A */	lis r5, lbl_8069C1E4@ha
/* 8052BAC8 00527008  3C 80 80 6A */	lis r4, lbl_8069C760@ha
/* 8052BACC 0052700C  38 A5 C1 E4 */	addi r5, r5, lbl_8069C1E4@l
/* 8052BAD0 00527010  3C 00 E0 00 */	lis r0, 0xe000
/* 8052BAD4 00527014  90 65 00 8C */	stw r3, 0x8c(r5)
/* 8052BAD8 00527018  38 60 00 00 */	li r3, 0
/* 8052BADC 0052701C  90 04 C7 60 */	stw r0, lbl_8069C760@l(r4)
/* 8052BAE0 00527020  80 01 00 14 */	lwz r0, 0x14(r1)
/* 8052BAE4 00527024  7C 08 03 A6 */	mtlr r0
/* 8052BAE8 00527028  38 21 00 10 */	addi r1, r1, 0x10
/* 8052BAEC 0052702C  4E 80 00 20 */	blr 

.global __TRK_copy_vectors
__TRK_copy_vectors:
/* 8052BAF0 00527030  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8052BAF4 00527034  7C 08 02 A6 */	mflr r0
/* 8052BAF8 00527038  3C 60 80 6A */	lis r3, lbl_8069C760@ha
/* 8052BAFC 0052703C  90 01 00 24 */	stw r0, 0x24(r1)
/* 8052BB00 00527040  38 63 C7 60 */	addi r3, r3, lbl_8069C760@l
/* 8052BB04 00527044  BF 61 00 0C */	stmw r27, 0xc(r1)
/* 8052BB08 00527048  80 63 00 00 */	lwz r3, 0(r3)
/* 8052BB0C 0052704C  28 03 00 44 */	cmplwi r3, 0x44
/* 8052BB10 00527050  41 81 00 2C */	bgt lbl_8052BB3C
/* 8052BB14 00527054  38 03 40 00 */	addi r0, r3, 0x4000
/* 8052BB18 00527058  28 00 00 44 */	cmplwi r0, 0x44
/* 8052BB1C 0052705C  40 81 00 20 */	ble lbl_8052BB3C
/* 8052BB20 00527060  3C 60 80 6A */	lis r3, gTRKCPUState@ha
/* 8052BB24 00527064  38 63 C2 88 */	addi r3, r3, gTRKCPUState@l
/* 8052BB28 00527068  80 03 02 38 */	lwz r0, 0x238(r3)
/* 8052BB2C 0052706C  54 00 07 BF */	clrlwi. r0, r0, 0x1e
/* 8052BB30 00527070  41 82 00 0C */	beq lbl_8052BB3C
/* 8052BB34 00527074  38 A0 00 44 */	li r5, 0x44
/* 8052BB38 00527078  48 00 00 0C */	b lbl_8052BB44
lbl_8052BB3C:
/* 8052BB3C 0052707C  3C 60 80 00 */	lis r3, 0x80000044@ha
/* 8052BB40 00527080  38 A3 00 44 */	addi r5, r3, 0x80000044@l
lbl_8052BB44:
/* 8052BB44 00527084  3C 80 80 5F */	lis r4, lbl_805F59B8@ha
/* 8052BB48 00527088  3C 60 80 6A */	lis r3, gTRKCPUState@ha
/* 8052BB4C 0052708C  83 A5 00 00 */	lwz r29, 0(r5)
/* 8052BB50 00527090  3B E4 59 B8 */	addi r31, r4, lbl_805F59B8@l
/* 8052BB54 00527094  3B 83 C2 88 */	addi r28, r3, gTRKCPUState@l
/* 8052BB58 00527098  3B C0 00 00 */	li r30, 0
lbl_8052BB5C:
/* 8052BB5C 0052709C  38 00 00 01 */	li r0, 1
/* 8052BB60 005270A0  7C 00 F0 30 */	slw r0, r0, r30
/* 8052BB64 005270A4  7F A0 00 39 */	and. r0, r29, r0
/* 8052BB68 005270A8  41 82 00 90 */	beq lbl_8052BBF8
/* 8052BB6C 005270AC  2C 1E 00 04 */	cmpwi r30, 4
/* 8052BB70 005270B0  41 82 00 88 */	beq lbl_8052BBF8
/* 8052BB74 005270B4  3C 60 80 6A */	lis r3, lbl_8069C760@ha
/* 8052BB78 005270B8  80 DF 00 00 */	lwz r6, 0(r31)
/* 8052BB7C 005270BC  38 63 C7 60 */	addi r3, r3, lbl_8069C760@l
/* 8052BB80 005270C0  80 63 00 00 */	lwz r3, 0(r3)
/* 8052BB84 005270C4  7C 06 18 40 */	cmplw r6, r3
/* 8052BB88 005270C8  41 80 00 24 */	blt lbl_8052BBAC
/* 8052BB8C 005270CC  38 03 40 00 */	addi r0, r3, 0x4000
/* 8052BB90 005270D0  7C 06 00 40 */	cmplw r6, r0
/* 8052BB94 005270D4  40 80 00 18 */	bge lbl_8052BBAC
/* 8052BB98 005270D8  80 1C 02 38 */	lwz r0, 0x238(r28)
/* 8052BB9C 005270DC  54 00 07 BF */	clrlwi. r0, r0, 0x1e
/* 8052BBA0 005270E0  41 82 00 0C */	beq lbl_8052BBAC
/* 8052BBA4 005270E4  7C DB 33 78 */	mr r27, r6
/* 8052BBA8 005270E8  48 00 00 2C */	b lbl_8052BBD4
lbl_8052BBAC:
/* 8052BBAC 005270EC  3C 00 7E 00 */	lis r0, 0x7e00
/* 8052BBB0 005270F0  7C 06 00 40 */	cmplw r6, r0
/* 8052BBB4 005270F4  41 80 00 18 */	blt lbl_8052BBCC
/* 8052BBB8 005270F8  3C 00 80 00 */	lis r0, 0x8000
/* 8052BBBC 005270FC  7C 06 00 40 */	cmplw r6, r0
/* 8052BBC0 00527100  41 81 00 0C */	bgt lbl_8052BBCC
/* 8052BBC4 00527104  7C DB 33 78 */	mr r27, r6
/* 8052BBC8 00527108  48 00 00 0C */	b lbl_8052BBD4
lbl_8052BBCC:
/* 8052BBCC 0052710C  54 C0 00 BE */	clrlwi r0, r6, 2
/* 8052BBD0 00527110  64 1B 80 00 */	oris r27, r0, 0x8000
lbl_8052BBD4:
/* 8052BBD4 00527114  3C 80 80 00 */	lis r4, lbl_800044C0@ha
/* 8052BBD8 00527118  7F 63 DB 78 */	mr r3, r27
/* 8052BBDC 0052711C  38 04 44 C0 */	addi r0, r4, lbl_800044C0@l
/* 8052BBE0 00527120  38 A0 01 00 */	li r5, 0x100
/* 8052BBE4 00527124  7C 80 32 14 */	add r4, r0, r6
/* 8052BBE8 00527128  4B AD 88 B5 */	bl TRK_memcpy
/* 8052BBEC 0052712C  7F 63 DB 78 */	mr r3, r27
/* 8052BBF0 00527130  38 80 01 00 */	li r4, 0x100
/* 8052BBF4 00527134  4B FF DD 55 */	bl TRK_flush_cache
lbl_8052BBF8:
/* 8052BBF8 00527138  3B DE 00 01 */	addi r30, r30, 1
/* 8052BBFC 0052713C  3B FF 00 04 */	addi r31, r31, 4
/* 8052BC00 00527140  2C 1E 00 0E */	cmpwi r30, 0xe
/* 8052BC04 00527144  40 81 FF 58 */	ble lbl_8052BB5C
/* 8052BC08 00527148  BB 61 00 0C */	lmw r27, 0xc(r1)
/* 8052BC0C 0052714C  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8052BC10 00527150  7C 08 03 A6 */	mtlr r0
/* 8052BC14 00527154  38 21 00 20 */	addi r1, r1, 0x20
/* 8052BC18 00527158  4E 80 00 20 */	blr 

.global TRKTargetTranslate
TRKTargetTranslate:
/* 8052BC1C 0052715C  3C 80 80 6A */	lis r4, lbl_8069C760@ha
/* 8052BC20 00527160  38 84 C7 60 */	addi r4, r4, lbl_8069C760@l
/* 8052BC24 00527164  80 84 00 00 */	lwz r4, 0(r4)
/* 8052BC28 00527168  7C 03 20 40 */	cmplw r3, r4
/* 8052BC2C 0052716C  41 80 00 24 */	blt lbl_8052BC50
/* 8052BC30 00527170  38 04 40 00 */	addi r0, r4, 0x4000
/* 8052BC34 00527174  7C 03 00 40 */	cmplw r3, r0
/* 8052BC38 00527178  40 80 00 18 */	bge lbl_8052BC50
/* 8052BC3C 0052717C  3C 80 80 6A */	lis r4, gTRKCPUState@ha
/* 8052BC40 00527180  38 84 C2 88 */	addi r4, r4, gTRKCPUState@l
/* 8052BC44 00527184  80 04 02 38 */	lwz r0, 0x238(r4)
/* 8052BC48 00527188  54 00 07 BF */	clrlwi. r0, r0, 0x1e
/* 8052BC4C 0052718C  4C 82 00 20 */	bnelr 
lbl_8052BC50:
/* 8052BC50 00527190  3C 00 7E 00 */	lis r0, 0x7e00
/* 8052BC54 00527194  7C 03 00 40 */	cmplw r3, r0
/* 8052BC58 00527198  41 80 00 10 */	blt lbl_8052BC68
/* 8052BC5C 0052719C  3C 00 80 00 */	lis r0, 0x8000
/* 8052BC60 005271A0  7C 03 00 40 */	cmplw r3, r0
/* 8052BC64 005271A4  4C 81 00 20 */	blelr 
lbl_8052BC68:
/* 8052BC68 005271A8  54 60 00 BE */	clrlwi r0, r3, 2
/* 8052BC6C 005271AC  64 03 80 00 */	oris r3, r0, 0x8000
/* 8052BC70 005271B0  4E 80 00 20 */	blr 

.global EnableMetroTRKInterrupts
EnableMetroTRKInterrupts:
/* 8052BC74 005271B4  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 8052BC78 005271B8  7C 08 02 A6 */	mflr r0
/* 8052BC7C 005271BC  90 01 00 14 */	stw r0, 0x14(r1)
/* 8052BC80 005271C0  48 00 02 75 */	bl EnableEXI2Interrupts
/* 8052BC84 005271C4  80 01 00 14 */	lwz r0, 0x14(r1)
/* 8052BC88 005271C8  7C 08 03 A6 */	mtlr r0
/* 8052BC8C 005271CC  38 21 00 10 */	addi r1, r1, 0x10
/* 8052BC90 005271D0  4E 80 00 20 */	blr 
