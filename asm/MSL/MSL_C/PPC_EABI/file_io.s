.text

.include "macros.inc"

.global fclose
fclose:
/* 8051A0B4 005155F4  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8051A0B8 005155F8  7C 08 02 A6 */	mflr r0
/* 8051A0BC 005155FC  2C 03 00 00 */	cmpwi r3, 0
/* 8051A0C0 00515600  90 01 00 24 */	stw r0, 0x24(r1)
/* 8051A0C4 00515604  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 8051A0C8 00515608  93 C1 00 18 */	stw r30, 0x18(r1)
/* 8051A0CC 0051560C  93 A1 00 14 */	stw r29, 0x14(r1)
/* 8051A0D0 00515610  7C 7D 1B 78 */	mr r29, r3
/* 8051A0D4 00515614  40 82 00 0C */	bne lbl_8051A0E0
/* 8051A0D8 00515618  38 60 FF FF */	li r3, -1
/* 8051A0DC 0051561C  48 00 00 78 */	b lbl_8051A154
lbl_8051A0E0:
/* 8051A0E0 00515620  80 03 00 04 */	lwz r0, 4(r3)
/* 8051A0E4 00515624  54 00 57 7F */	rlwinm. r0, r0, 0xa, 0x1d, 0x1f
/* 8051A0E8 00515628  40 82 00 0C */	bne lbl_8051A0F4
/* 8051A0EC 0051562C  38 60 00 00 */	li r3, 0
/* 8051A0F0 00515630  48 00 00 64 */	b lbl_8051A154
lbl_8051A0F4:
/* 8051A0F4 00515634  48 00 00 7D */	bl fflush
/* 8051A0F8 00515638  81 9D 00 44 */	lwz r12, 0x44(r29)
/* 8051A0FC 0051563C  7C 7E 1B 78 */	mr r30, r3
/* 8051A100 00515640  80 7D 00 00 */	lwz r3, 0(r29)
/* 8051A104 00515644  7D 89 03 A6 */	mtctr r12
/* 8051A108 00515648  4E 80 04 21 */	bctrl 
/* 8051A10C 0051564C  80 1D 00 08 */	lwz r0, 8(r29)
/* 8051A110 00515650  38 A0 00 00 */	li r5, 0
/* 8051A114 00515654  80 9D 00 04 */	lwz r4, 4(r29)
/* 8051A118 00515658  7C 7F 1B 78 */	mr r31, r3
/* 8051A11C 0051565C  54 00 27 FF */	rlwinm. r0, r0, 4, 0x1f, 0x1f
/* 8051A120 00515660  90 BD 00 00 */	stw r5, 0(r29)
/* 8051A124 00515664  54 84 02 8C */	rlwinm r4, r4, 0, 0xa, 6
/* 8051A128 00515668  90 9D 00 04 */	stw r4, 4(r29)
/* 8051A12C 0051566C  41 82 00 0C */	beq lbl_8051A138
/* 8051A130 00515670  80 7D 00 1C */	lwz r3, 0x1c(r29)
/* 8051A134 00515674  4B FF DF A1 */	bl free
lbl_8051A138:
/* 8051A138 00515678  2C 1E 00 00 */	cmpwi r30, 0
/* 8051A13C 0051567C  38 00 00 00 */	li r0, 0
/* 8051A140 00515680  40 82 00 0C */	bne lbl_8051A14C
/* 8051A144 00515684  2C 1F 00 00 */	cmpwi r31, 0
/* 8051A148 00515688  41 82 00 08 */	beq lbl_8051A150
lbl_8051A14C:
/* 8051A14C 0051568C  38 00 00 01 */	li r0, 1
lbl_8051A150:
/* 8051A150 00515690  7C 60 00 D0 */	neg r3, r0
lbl_8051A154:
/* 8051A154 00515694  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8051A158 00515698  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 8051A15C 0051569C  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 8051A160 005156A0  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 8051A164 005156A4  7C 08 03 A6 */	mtlr r0
/* 8051A168 005156A8  38 21 00 20 */	addi r1, r1, 0x20
/* 8051A16C 005156AC  4E 80 00 20 */	blr 

.global fflush
fflush:
/* 8051A170 005156B0  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 8051A174 005156B4  7C 08 02 A6 */	mflr r0
/* 8051A178 005156B8  2C 03 00 00 */	cmpwi r3, 0
/* 8051A17C 005156BC  90 01 00 14 */	stw r0, 0x14(r1)
/* 8051A180 005156C0  93 E1 00 0C */	stw r31, 0xc(r1)
/* 8051A184 005156C4  7C 7F 1B 78 */	mr r31, r3
/* 8051A188 005156C8  93 C1 00 08 */	stw r30, 8(r1)
/* 8051A18C 005156CC  40 82 00 0C */	bne lbl_8051A198
/* 8051A190 005156D0  4B FF E1 19 */	bl __flush_all
/* 8051A194 005156D4  48 00 00 F8 */	b lbl_8051A28C
lbl_8051A198:
/* 8051A198 005156D8  88 03 00 0A */	lbz r0, 0xa(r3)
/* 8051A19C 005156DC  2C 00 00 00 */	cmpwi r0, 0
/* 8051A1A0 005156E0  40 82 00 10 */	bne lbl_8051A1B0
/* 8051A1A4 005156E4  80 83 00 04 */	lwz r4, 4(r3)
/* 8051A1A8 005156E8  54 80 57 7F */	rlwinm. r0, r4, 0xa, 0x1d, 0x1f
/* 8051A1AC 005156EC  40 82 00 0C */	bne lbl_8051A1B8
lbl_8051A1B0:
/* 8051A1B0 005156F0  38 60 FF FF */	li r3, -1
/* 8051A1B4 005156F4  48 00 00 D8 */	b lbl_8051A28C
lbl_8051A1B8:
/* 8051A1B8 005156F8  54 80 2F 7E */	rlwinm r0, r4, 5, 0x1d, 0x1f
/* 8051A1BC 005156FC  28 00 00 01 */	cmplwi r0, 1
/* 8051A1C0 00515700  40 82 00 0C */	bne lbl_8051A1CC
/* 8051A1C4 00515704  38 60 00 00 */	li r3, 0
/* 8051A1C8 00515708  48 00 00 C4 */	b lbl_8051A28C
lbl_8051A1CC:
/* 8051A1CC 0051570C  80 83 00 08 */	lwz r4, 8(r3)
/* 8051A1D0 00515710  54 80 1F 7E */	srwi r0, r4, 0x1d
/* 8051A1D4 00515714  28 00 00 03 */	cmplwi r0, 3
/* 8051A1D8 00515718  41 80 00 10 */	blt lbl_8051A1E8
/* 8051A1DC 0051571C  38 00 00 02 */	li r0, 2
/* 8051A1E0 00515720  50 04 E8 04 */	rlwimi r4, r0, 0x1d, 0, 2
/* 8051A1E4 00515724  90 83 00 08 */	stw r4, 8(r3)
lbl_8051A1E8:
/* 8051A1E8 00515728  80 03 00 08 */	lwz r0, 8(r3)
/* 8051A1EC 0051572C  54 00 1F 7E */	srwi r0, r0, 0x1d
/* 8051A1F0 00515730  28 00 00 02 */	cmplwi r0, 2
/* 8051A1F4 00515734  40 82 00 0C */	bne lbl_8051A200
/* 8051A1F8 00515738  38 00 00 00 */	li r0, 0
/* 8051A1FC 0051573C  90 03 00 28 */	stw r0, 0x28(r3)
lbl_8051A200:
/* 8051A200 00515740  80 83 00 08 */	lwz r4, 8(r3)
/* 8051A204 00515744  54 80 1F 7E */	srwi r0, r4, 0x1d
/* 8051A208 00515748  28 00 00 01 */	cmplwi r0, 1
/* 8051A20C 0051574C  41 82 00 14 */	beq lbl_8051A220
/* 8051A210 00515750  54 80 00 FE */	clrlwi r0, r4, 3
/* 8051A214 00515754  90 03 00 08 */	stw r0, 8(r3)
/* 8051A218 00515758  38 60 00 00 */	li r3, 0
/* 8051A21C 0051575C  48 00 00 70 */	b lbl_8051A28C
lbl_8051A220:
/* 8051A220 00515760  80 03 00 04 */	lwz r0, 4(r3)
/* 8051A224 00515764  54 00 57 7E */	rlwinm r0, r0, 0xa, 0x1d, 0x1f
/* 8051A228 00515768  28 00 00 01 */	cmplwi r0, 1
/* 8051A22C 0051576C  41 82 00 0C */	beq lbl_8051A238
/* 8051A230 00515770  3B C0 00 00 */	li r30, 0
/* 8051A234 00515774  48 00 00 10 */	b lbl_8051A244
lbl_8051A238:
/* 8051A238 00515778  7F E3 FB 78 */	mr r3, r31
/* 8051A23C 0051577C  48 00 01 11 */	bl ftell
/* 8051A240 00515780  7C 7E 1B 78 */	mr r30, r3
lbl_8051A244:
/* 8051A244 00515784  7F E3 FB 78 */	mr r3, r31
/* 8051A248 00515788  38 80 00 00 */	li r4, 0
/* 8051A24C 0051578C  4B FF FA 71 */	bl __flush_buffer
/* 8051A250 00515790  2C 03 00 00 */	cmpwi r3, 0
/* 8051A254 00515794  41 82 00 1C */	beq lbl_8051A270
/* 8051A258 00515798  38 60 00 01 */	li r3, 1
/* 8051A25C 0051579C  38 00 00 00 */	li r0, 0
/* 8051A260 005157A0  98 7F 00 0A */	stb r3, 0xa(r31)
/* 8051A264 005157A4  38 60 FF FF */	li r3, -1
/* 8051A268 005157A8  90 1F 00 28 */	stw r0, 0x28(r31)
/* 8051A26C 005157AC  48 00 00 20 */	b lbl_8051A28C
lbl_8051A270:
/* 8051A270 005157B0  80 1F 00 08 */	lwz r0, 8(r31)
/* 8051A274 005157B4  38 80 00 00 */	li r4, 0
/* 8051A278 005157B8  93 DF 00 18 */	stw r30, 0x18(r31)
/* 8051A27C 005157BC  38 60 00 00 */	li r3, 0
/* 8051A280 005157C0  54 00 00 FE */	clrlwi r0, r0, 3
/* 8051A284 005157C4  90 1F 00 08 */	stw r0, 8(r31)
/* 8051A288 005157C8  90 9F 00 28 */	stw r4, 0x28(r31)
lbl_8051A28C:
/* 8051A28C 005157CC  80 01 00 14 */	lwz r0, 0x14(r1)
/* 8051A290 005157D0  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 8051A294 005157D4  83 C1 00 08 */	lwz r30, 8(r1)
/* 8051A298 005157D8  7C 08 03 A6 */	mtlr r0
/* 8051A29C 005157DC  38 21 00 10 */	addi r1, r1, 0x10
/* 8051A2A0 005157E0  4E 80 00 20 */	blr 
